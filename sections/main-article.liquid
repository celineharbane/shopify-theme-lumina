{%- comment -%}
  LUMINA Theme - Main Article Section
{%- endcomment -%}

<article class="main-article section-padding" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="page-width page-width--narrow">

    {%- for block in section.blocks -%}
      {%- case block.type -%}

        {%- when 'featured_image' -%}
          {%- if article.image -%}
            <figure class="main-article__featured-image" {{ block.shopify_attributes }}>
              {{ article.image | image_url: width: 1200 | image_tag:
                loading: 'eager',
                sizes: '(min-width: 990px) 800px, 100vw',
                widths: '400, 600, 800, 1000, 1200',
                alt: article.title,
                itemprop: 'image'
              }}
            </figure>
          {%- endif -%}

        {%- when 'title' -%}
          <header class="main-article__header" {{ block.shopify_attributes }}>
            <h1 class="main-article__title h1" itemprop="headline">{{ article.title }}</h1>
          </header>

        {%- when 'meta' -%}
          <div class="main-article__meta" {{ block.shopify_attributes }}>
            {%- if block.settings.show_date -%}
              <time datetime="{{ article.published_at | date: '%Y-%m-%d' }}" itemprop="datePublished">
                {{ article.published_at | date: format: 'date' }}
              </time>
            {%- endif -%}
            {%- if block.settings.show_author -%}
              <span class="main-article__author" itemprop="author" itemscope itemtype="https://schema.org/Person">
                <span itemprop="name">{{ article.author }}</span>
              </span>
            {%- endif -%}
            {%- if article.tags.size > 0 -%}
              <div class="main-article__tags">
                {%- for tag in article.tags -%}
                  <a href="{{ blog.url }}/tagged/{{ tag | handle }}">{{ tag }}</a>
                {%- endfor -%}
              </div>
            {%- endif -%}
          </div>

        {%- when 'content' -%}
          <div class="main-article__content rte" itemprop="articleBody" {{ block.shopify_attributes }}>
            {{ article.content }}
          </div>

        {%- when 'share' -%}
          <div class="main-article__share" {{ block.shopify_attributes }}>
            <span class="main-article__share-label">{{ 'blogs.article.share' | t }}:</span>
            <div class="main-article__share-buttons">
              <a href="https://www.facebook.com/sharer.php?u={{ shop.url }}{{ article.url }}" target="_blank" rel="noopener" aria-label="{{ 'general.social.share_on_facebook' | t }}">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>
              </a>
              <a href="https://twitter.com/intent/tweet?url={{ shop.url }}{{ article.url }}&text={{ article.title | url_encode }}" target="_blank" rel="noopener" aria-label="{{ 'general.social.share_on_twitter' | t }}">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4l11.733 16h4.267l-11.733 -16z"/><path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772"/></svg>
              </a>
              <a href="https://pinterest.com/pin/create/button/?url={{ shop.url }}{{ article.url }}&media={{ article.image | image_url: width: 1000 }}&description={{ article.title | url_encode }}" target="_blank" rel="noopener" aria-label="{{ 'general.social.share_on_pinterest' | t }}">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" x2="12" y1="17" y2="22"/><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"/></svg>
              </a>
            </div>
          </div>

      {%- endcase -%}
    {%- endfor -%}

    {%- comment -%} Comments Section {%- endcomment -%}
    {%- if section.settings.show_comments and blog.comments_enabled? -%}
      <div class="main-article__comments" id="comments">
        <h2 class="main-article__comments-title h4">
          {{ 'blogs.article.comments' | t: count: article.comments_count }}
        </h2>

        {%- if article.comments_count > 0 -%}
          {%- paginate article.comments by 10 -%}
            <div class="main-article__comments-list">
              {%- for comment in article.comments -%}
                <div class="comment" id="comment-{{ comment.id }}">
                  <div class="comment__header">
                    <span class="comment__author">{{ comment.author }}</span>
                    <time class="comment__date" datetime="{{ comment.created_at | date: '%Y-%m-%d' }}">
                      {{ comment.created_at | date: format: 'date' }}
                    </time>
                  </div>
                  <div class="comment__content">
                    {{ comment.content }}
                  </div>
                </div>
              {%- endfor -%}
            </div>

            {%- if paginate.pages > 1 -%}
              {%- render 'pagination', paginate: paginate -%}
            {%- endif -%}
          {%- endpaginate -%}
        {%- endif -%}

        {%- comment -%} Comment Form {%- endcomment -%}
        <div class="main-article__comment-form">
          <h3 class="h5">{{ 'blogs.article.comment_form_title' | t }}</h3>

          {%- if blog.moderated? -%}
            <p class="main-article__comment-notice">{{ 'blogs.article.moderated' | t }}</p>
          {%- endif -%}

          {%- form 'new_comment', article, class: 'comment-form' -%}
            {%- if form.posted_successfully? -%}
              <p class="form-success">
                {%- if blog.moderated? -%}
                  {{ 'blogs.article.success_moderated' | t }}
                {%- else -%}
                  {{ 'blogs.article.success' | t }}
                {%- endif -%}
              </p>
            {%- endif -%}

            {%- if form.errors -%}
              <div class="form-errors">
                {{ form.errors | default_errors }}
              </div>
            {%- endif -%}

            <div class="comment-form__row">
              <div class="comment-form__field">
                <label for="CommentAuthor">{{ 'blogs.article.name' | t }}</label>
                <input type="text" name="comment[author]" id="CommentAuthor" value="{{ form.author }}" required>
              </div>
              <div class="comment-form__field">
                <label for="CommentEmail">{{ 'blogs.article.email' | t }}</label>
                <input type="email" name="comment[email]" id="CommentEmail" value="{{ form.email }}" required>
              </div>
            </div>

            <div class="comment-form__field">
              <label for="CommentBody">{{ 'blogs.article.message' | t }}</label>
              <textarea name="comment[body]" id="CommentBody" rows="5" required>{{ form.body }}</textarea>
            </div>

            <button type="submit" class="button">{{ 'blogs.article.post' | t }}</button>
          {%- endform -%}
        </div>
      </div>
    {%- endif -%}

    {%- comment -%} Back to Blog Link {%- endcomment -%}
    <div class="main-article__back">
      <a href="{{ blog.url }}">
        {%- render 'icon-arrow-left' -%}
        {{ 'blogs.article.back_to_blog' | t }}
      </a>
    </div>

  </div>
</article>

<style>
.main-article {
  max-width: 800px;
  margin: 0 auto;
}

.main-article__featured-image {
  margin: 0 0 2rem;
  border-radius: var(--border-radius);
  overflow: hidden;
}

.main-article__featured-image img {
  width: 100%;
  height: auto;
}

.main-article__header {
  margin-bottom: 1rem;
}

.main-article__title {
  margin: 0;
}

.main-article__meta {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 1rem;
  color: var(--color-text-light);
  font-size: 0.9375rem;
  margin-bottom: 2rem;
  padding-bottom: 2rem;
  border-bottom: 1px solid var(--color-border);
}

.main-article__tags {
  display: flex;
  gap: 0.5rem;
}

.main-article__tags a {
  padding: 0.25rem 0.75rem;
  background: var(--color-background-secondary);
  border-radius: 2rem;
  font-size: 0.8125rem;
  color: var(--color-text);
  text-decoration: none;
}

.main-article__tags a:hover {
  background: var(--color-primary);
  color: var(--color-button-text);
}

.main-article__content {
  margin-bottom: 2rem;
}

.main-article__share {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.5rem 0;
  border-top: 1px solid var(--color-border);
  border-bottom: 1px solid var(--color-border);
  margin-bottom: 2rem;
}

.main-article__share-buttons {
  display: flex;
  gap: 0.75rem;
}

.main-article__share-buttons a {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--color-background-secondary);
  color: var(--color-text);
  transition: all 0.2s;
}

.main-article__share-buttons a:hover {
  background: var(--color-primary);
  color: var(--color-button-text);
}

.main-article__comments {
  margin-top: 3rem;
  padding-top: 3rem;
  border-top: 1px solid var(--color-border);
}

.main-article__comments-title {
  margin-bottom: 1.5rem;
}

.comment {
  padding: 1.5rem 0;
  border-bottom: 1px solid var(--color-border);
}

.comment__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.75rem;
}

.comment__author {
  font-weight: 600;
}

.comment__date {
  font-size: 0.8125rem;
  color: var(--color-text-light);
}

.comment__content {
  color: var(--color-text-light);
  line-height: 1.6;
}

.main-article__comment-form {
  margin-top: 2rem;
}

.main-article__comment-notice {
  font-size: 0.875rem;
  color: var(--color-text-light);
  margin-bottom: 1rem;
}

.comment-form__row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-bottom: 1rem;
}

@media (max-width: 600px) {
  .comment-form__row {
    grid-template-columns: 1fr;
  }
}

.comment-form__field {
  margin-bottom: 1rem;
}

.comment-form__field label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.comment-form__field input,
.comment-form__field textarea {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius);
  font-size: 1rem;
}

.comment-form__field input:focus,
.comment-form__field textarea:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);
}

.main-article__back {
  margin-top: 2rem;
}

.main-article__back a {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--color-primary);
  text-decoration: none;
}

.main-article__back a:hover {
  text-decoration: underline;
}

.main-article__back svg {
  width: 1rem;
  height: 1rem;
}

.form-success {
  padding: 1rem;
  background: rgba(40, 167, 69, 0.1);
  border: 1px solid #28a745;
  border-radius: var(--border-radius);
  color: #28a745;
  margin-bottom: 1rem;
}

.form-errors {
  padding: 1rem;
  background: rgba(220, 53, 69, 0.1);
  border: 1px solid #dc3545;
  border-radius: var(--border-radius);
  color: #dc3545;
  margin-bottom: 1rem;
}
</style>

{% schema %}
{
  "name": "Blog post",
  "tag": "section",
  "class": "section-main-article",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_comments",
      "label": "Show comments",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "featured_image",
      "name": "Featured image",
      "limit": 1,
      "settings": []
    },
    {
      "type": "title",
      "name": "Title",
      "limit": 1,
      "settings": []
    },
    {
      "type": "meta",
      "name": "Meta info",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_date",
          "label": "Show date",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_author",
          "label": "Show author",
          "default": true
        }
      ]
    },
    {
      "type": "content",
      "name": "Content",
      "limit": 1,
      "settings": []
    },
    {
      "type": "share",
      "name": "Share buttons",
      "limit": 1,
      "settings": []
    }
  ]
}
{% endschema %}
