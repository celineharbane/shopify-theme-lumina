{%- comment -%}
  LUMINA Theme - Header Section
  Premium Shopify Theme by CÃ©line Dev Studio
  Ritual-inspired luxury design
{%- endcomment -%}

{{ 'section-header.css' | asset_url | stylesheet_tag }}
{%- if settings.menu_style == 'mega' -%}
  {{ 'component-mega-menu.css' | asset_url | stylesheet_tag }}
{%- endif -%}

{%- comment -%} Announcement Bar {%- endcomment -%}
{%- if settings.show_announcement and settings.announcement_text != blank -%}
  <div class="announcement-bar" data-announcement-bar>
    {%- if settings.announcement_link != blank -%}
      <a href="{{ settings.announcement_link }}">{{ settings.announcement_text }}</a>
    {%- else -%}
      {{ settings.announcement_text }}
    {%- endif -%}
  </div>
{%- endif -%}

<sticky-header class="header{% if section.settings.sticky_header %} header--sticky{% endif %}{% if section.settings.transparent_header %} header--transparent{% endif %} header--{{ settings.header_style | default: 'classic' }}">
  <header class="header__wrapper">
    <div class="page-width">
      <div class="header__inner">
        {%- comment -%} Mobile menu button {%- endcomment -%}
        <button
          class="header__icon-button header__menu-button md:hidden"
          data-mobile-menu-open
          aria-label="{{ 'accessibility.menu' | t }}"
          aria-expanded="false"
        >
          {%- render 'icon-menu' -%}
        </button>

        {%- comment -%} Logo {%- endcomment -%}
        <div class="header__logo">
          {%- if section.settings.logo != blank -%}
            <a href="{{ routes.root_url }}" class="header__logo-link">
              {%- assign logo_width = section.settings.logo_width -%}
              {%- assign logo_height = section.settings.logo.height | times: logo_width | divided_by: section.settings.logo.width -%}
              <img
                src="{{ section.settings.logo | image_url: width: logo_width }}"
                srcset="{{ section.settings.logo | image_url: width: logo_width }} 1x, {{ section.settings.logo | image_url: width: logo_width | times: 2 }} 2x"
                alt="{{ section.settings.logo.alt | default: shop.name }}"
                width="{{ logo_width }}"
                height="{{ logo_height }}"
                loading="eager"
                class="header__logo-image"
              >
            </a>
          {%- else -%}
            <a href="{{ routes.root_url }}" class="header__logo-text h4">
              {{ shop.name }}
            </a>
          {%- endif -%}
        </div>

        {%- comment -%} Desktop Navigation {%- endcomment -%}
        <nav class="header__nav hidden md:flex" role="navigation" aria-label="{{ 'accessibility.main_navigation' | t }}">
          <ul class="header__menu" role="list">
            {%- for link in section.settings.menu.links -%}
              <li class="header__menu-item{% if link.links != blank %} has-dropdown{% endif %}">
                {%- if link.links != blank -%}
                  <details class="header__dropdown">
                    <summary class="header__menu-link">
                      {{ link.title }}
                      {%- render 'icon-chevron-down' -%}
                    </summary>

                    {%- comment -%} Mega Menu {%- endcomment -%}
                    {%- if settings.menu_style == 'mega' -%}
                      <div class="mega-menu">
                        <div class="mega-menu__inner">
                          {%- comment -%} Main Links Column {%- endcomment -%}
                          <div class="mega-menu__column">
                            <h3 class="mega-menu__column-title">{{ link.title }}</h3>
                            <div class="mega-menu__links">
                              {%- for child_link in link.links -%}
                                <a href="{{ child_link.url }}" class="mega-menu__link{% if child_link.active %} is-active{% endif %}">
                                  {{ child_link.title }}
                                </a>
                              {%- endfor -%}
                            </div>
                          </div>

                          {%- comment -%} Additional Columns from Blocks {%- endcomment -%}
                          {%- for block in section.blocks -%}
                            {%- if block.type == 'mega_menu_column' and block.settings.parent_link == link.title -%}
                              <div class="mega-menu__column" {{ block.shopify_attributes }}>
                                {%- if block.settings.column_title != blank -%}
                                  <h3 class="mega-menu__column-title">{{ block.settings.column_title }}</h3>
                                {%- endif -%}
                                {%- if block.settings.column_links != blank -%}
                                  <div class="mega-menu__links">
                                    {%- for column_link in block.settings.column_links.links -%}
                                      <a href="{{ column_link.url }}" class="mega-menu__link">
                                        {{ column_link.title }}
                                      </a>
                                    {%- endfor -%}
                                  </div>
                                {%- endif -%}
                              </div>
                            {%- endif -%}
                          {%- endfor -%}

                          {%- comment -%} Featured Image from Blocks {%- endcomment -%}
                          {%- for block in section.blocks -%}
                            {%- if block.type == 'mega_menu_promo' and block.settings.parent_link == link.title -%}
                              <div class="mega-menu__featured" {{ block.shopify_attributes }}>
                                {%- if block.settings.promo_image != blank -%}
                                  <div class="mega-menu__featured-image">
                                    {{ block.settings.promo_image | image_url: width: 600 | image_tag:
                                      loading: 'lazy',
                                      alt: block.settings.promo_title
                                    }}
                                  </div>
                                {%- endif -%}
                                <div class="mega-menu__featured-content">
                                  {%- if block.settings.promo_subtitle != blank -%}
                                    <span class="mega-menu__featured-subtitle">{{ block.settings.promo_subtitle }}</span>
                                  {%- endif -%}
                                  {%- if block.settings.promo_title != blank -%}
                                    <h4 class="mega-menu__featured-title">{{ block.settings.promo_title }}</h4>
                                  {%- endif -%}
                                </div>
                                {%- if block.settings.promo_link != blank -%}
                                  <a href="{{ block.settings.promo_link }}" class="mega-menu__featured-link" aria-label="{{ block.settings.promo_title }}"></a>
                                {%- endif -%}
                              </div>
                            {%- endif -%}
                          {%- endfor -%}
                        </div>

                        {%- comment -%} Promo Banner {%- endcomment -%}
                        {%- for block in section.blocks -%}
                          {%- if block.type == 'mega_menu_banner' and block.settings.parent_link == link.title -%}
                            <div class="mega-menu__promo" {{ block.shopify_attributes }}>
                              <p class="mega-menu__promo-text">{{ block.settings.banner_text }}</p>
                            </div>
                          {%- endif -%}
                        {%- endfor -%}
                      </div>
                    {%- else -%}
                      {%- comment -%} Standard Dropdown {%- endcomment -%}
                      <div class="header__dropdown-content">
                        <ul class="header__submenu" role="list">
                          {%- for child_link in link.links -%}
                            <li>
                              <a href="{{ child_link.url }}" class="header__submenu-link{% if child_link.active %} is-active{% endif %}">
                                {{ child_link.title }}
                              </a>
                            </li>
                          {%- endfor -%}
                        </ul>
                      </div>
                    {%- endif -%}
                  </details>
                {%- else -%}
                  <a href="{{ link.url }}" class="header__menu-link{% if link.active %} is-active{% endif %}">
                    {{ link.title }}
                  </a>
                {%- endif -%}
              </li>
            {%- endfor -%}
          </ul>
        </nav>

        {%- comment -%} Header Icons {%- endcomment -%}
        <div class="header__icons">
          {%- if section.settings.show_search -%}
            <button
              class="header__icon-button"
              data-search-open
              aria-label="{{ 'accessibility.search' | t }}"
            >
              {%- render 'icon-search' -%}
            </button>
          {%- endif -%}

          {%- if section.settings.show_account and shop.customer_accounts_enabled -%}
            <a
              href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
              class="header__icon-button hidden md:flex"
              aria-label="{{ 'accessibility.account' | t }}"
            >
              {%- render 'icon-account' -%}
            </a>
          {%- endif -%}

          <a
            href="{{ routes.cart_url }}"
            class="header__icon-button header__cart-button"
            aria-label="{{ 'accessibility.cart' | t }}"
            {% if settings.cart_type == 'drawer' %}
              data-cart-open
            {% endif %}
          >
            {%- render 'icon-cart' -%}
            <span
              class="header__cart-count{% if cart.item_count == 0 %} is-hidden{% endif %}"
              data-cart-count
            >
              {{ cart.item_count }}
            </span>
          </a>
        </div>
      </div>
    </div>
  </header>
</sticky-header>

{%- comment -%} Mobile Menu {%- endcomment -%}
<mobile-menu class="mobile-menu md:hidden">
  <div class="mobile-menu__overlay"></div>
  <div class="mobile-menu__drawer">
    <div class="mobile-menu__header">
      <span class="mobile-menu__title">{{ 'accessibility.menu' | t }}</span>
      <button class="mobile-menu__close" data-mobile-menu-close aria-label="{{ 'accessibility.close' | t }}">
        {%- render 'icon-close' -%}
      </button>
    </div>

    <nav class="mobile-menu__nav" role="navigation">
      <ul class="mobile-menu__list" role="list">
        {%- for link in section.settings.menu.links -%}
          <li class="mobile-menu__item{% if link.links != blank %} has-submenu{% endif %}">
            {%- if link.links != blank -%}
              <button class="mobile-menu__link" data-submenu-toggle aria-expanded="false">
                {{ link.title }}
                {%- render 'icon-chevron-down' -%}
              </button>
              <ul class="mobile-menu__submenu" role="list">
                {%- for child_link in link.links -%}
                  <li>
                    <a href="{{ child_link.url }}" class="mobile-menu__sublink">
                      {{ child_link.title }}
                    </a>
                  </li>
                {%- endfor -%}
              </ul>
            {%- else -%}
              <a href="{{ link.url }}" class="mobile-menu__link">
                {{ link.title }}
              </a>
            {%- endif -%}
          </li>
        {%- endfor -%}
      </ul>
    </nav>

    {%- if shop.customer_accounts_enabled -%}
      <div class="mobile-menu__footer">
        <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}" class="mobile-menu__account">
          {%- render 'icon-account' -%}
          {%- if customer -%}
            {{ 'customer.account.title' | t }}
          {%- else -%}
            {{ 'customer.login.title' | t }}
          {%- endif -%}
        </a>
      </div>
    {%- endif -%}
  </div>
</mobile-menu>

{% schema %}
{
  "name": "Header",
  "class": "section-header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "default": 150,
      "unit": "px",
      "label": "Logo width"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    },
    {
      "type": "header",
      "content": "Header options"
    },
    {
      "type": "checkbox",
      "id": "sticky_header",
      "default": true,
      "label": "Enable sticky header"
    },
    {
      "type": "checkbox",
      "id": "transparent_header",
      "default": false,
      "label": "Transparent header on homepage",
      "info": "Works best with a hero image"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "default": true,
      "label": "Show search icon"
    },
    {
      "type": "checkbox",
      "id": "show_account",
      "default": true,
      "label": "Show account icon"
    }
  ],
  "blocks": [
    {
      "type": "mega_menu_column",
      "name": "Mega menu column",
      "settings": [
        {
          "type": "text",
          "id": "parent_link",
          "label": "Parent menu item",
          "info": "Enter the exact title of the parent menu item"
        },
        {
          "type": "text",
          "id": "column_title",
          "label": "Column title"
        },
        {
          "type": "link_list",
          "id": "column_links",
          "label": "Column links"
        }
      ]
    },
    {
      "type": "mega_menu_promo",
      "name": "Mega menu promo",
      "settings": [
        {
          "type": "text",
          "id": "parent_link",
          "label": "Parent menu item",
          "info": "Enter the exact title of the parent menu item"
        },
        {
          "type": "image_picker",
          "id": "promo_image",
          "label": "Promo image"
        },
        {
          "type": "text",
          "id": "promo_subtitle",
          "label": "Subtitle",
          "default": "New Collection"
        },
        {
          "type": "text",
          "id": "promo_title",
          "label": "Title",
          "default": "Spring/Summer 2024"
        },
        {
          "type": "url",
          "id": "promo_link",
          "label": "Link"
        }
      ]
    },
    {
      "type": "mega_menu_banner",
      "name": "Mega menu banner",
      "settings": [
        {
          "type": "text",
          "id": "parent_link",
          "label": "Parent menu item",
          "info": "Enter the exact title of the parent menu item"
        },
        {
          "type": "richtext",
          "id": "banner_text",
          "label": "Banner text",
          "default": "<p>Use code <strong>LUMINA20</strong> for 20% off your first order</p>"
        }
      ]
    }
  ]
}
{% endschema %}
